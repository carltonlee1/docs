---
title: "POST /routes/{id}/feedback"
description: "Submit performance feedback for a routing decision"
---

## Endpoint

```
POST https://api.pathfinder.naivana.io/v1/routes/{decision_id}/feedback
```

## Description

Submit actual performance metrics after completing a request. This feedback helps improve routing accuracy over time.

**Key Features:**
- **Idempotent**: Submitting multiple times for the same decision updates the existing feedback (last write wins)
- **Rate Limited**: Maximum 10 feedback submissions per second per tenant
- **Privacy-Safe**: Only performance metrics are stored, no prompt content

## Request

### Headers

```http
Content-Type: application/json
Authorization: Bearer sk_live_your_api_key_here
```

### Path Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `decision_id` | string | Yes | The UUID of the routing decision to submit feedback for |

### Request Body

```json
{
  "actual_latency_ms": 1234,
  "actual_cost_usd": 0.0023,
  "actual_tokens_used": 456,
  "completion_success": true,
  "user_rating": 5
}
```

### Parameters

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `actual_latency_ms` | integer | Yes | Actual request latency in milliseconds (min: 0) |
| `actual_cost_usd` | float | Yes | Actual cost in USD (min: 0.0) |
| `actual_tokens_used` | integer | Yes | Actual tokens consumed (min: 0) |
| `completion_success` | boolean | Yes | Whether the request completed successfully |
| `error_type` | string | Conditional | Required if `completion_success` is false |
| `error_message` | string | No | Error details if failed (max 1000 chars) |
| `user_rating` | integer | No | User quality rating (1-5 scale) |
| `response_quality_score` | float | No | Automated quality score (0.0-1.0) |

### Error Types

When `completion_success` is `false`, you must provide one of these error types:

| Error Type | Description |
|------------|-------------|
| `timeout` | Request timed out |
| `rate_limit` | Rate limit exceeded at provider |
| `error` | Generic error |
| `invalid_request` | Invalid request to provider |
| `service_unavailable` | Provider service unavailable |
| `unauthorized` | Authentication failed at provider |
| `quota_exceeded` | Usage quota exceeded |

## Response

### Success Response (200 OK)

```json
{
  "decision_id": "550e8400-e29b-41d4-a716-446655440000",
  "feedback_received_at": "2025-11-11T15:35:00Z",
  "message": "Feedback received successfully"
}
```

### Response Fields

| Field | Type | Description |
|-------|------|-------------|
| `decision_id` | string | UUID of the routing decision |
| `feedback_received_at` | string | ISO 8601 timestamp when feedback was recorded |
| `message` | string | Success confirmation message |

## Error Responses

### 404 Not Found

```json
{
  "detail": "Decision 550e8400-e29b-41d4-a716-446655440000 not found or does not belong to tenant"
}
```

### 429 Too Many Requests

```json
{
  "detail": "Rate limit exceeded. Maximum 10 feedback submissions per second."
}
```

### 400 Bad Request

```json
{
  "detail": [
    {
      "loc": ["body", "error_type"],
      "msg": "error_type is required when completion_success is False",
      "type": "value_error"
    }
  ]
}
```

### 401 Unauthorized

```json
{
  "detail": "Missing tenant authentication"
}
```

## Examples

### cURL - Successful Completion

```bash
curl -X POST https://api.pathfinder.naivana.io/v1/routes/550e8400-e29b-41d4-a716-446655440000/feedback \
  -H "Authorization: Bearer sk_live_abc123..." \
  -H "Content-Type: application/json" \
  -d '{
    "actual_latency_ms": 1234,
    "actual_cost_usd": 0.0023,
    "actual_tokens_used": 456,
    "completion_success": true,
    "user_rating": 5
  }'
```

### cURL - Failed Request

```bash
curl -X POST https://api.pathfinder.naivana.io/v1/routes/550e8400-e29b-41d4-a716-446655440000/feedback \
  -H "Authorization: Bearer sk_live_abc123..." \
  -H "Content-Type: application/json" \
  -d '{
    "actual_latency_ms": 30000,
    "actual_cost_usd": 0,
    "actual_tokens_used": 0,
    "completion_success": false,
    "error_type": "timeout",
    "error_message": "Request timed out after 30 seconds"
  }'
```

### Python

```python
import requests

decision_id = "550e8400-e29b-41d4-a716-446655440000"

# After making your LLM request, submit feedback
response = requests.post(
    f"https://api.pathfinder.naivana.io/v1/routes/{decision_id}/feedback",
    headers={
        "Authorization": "Bearer sk_live_abc123...",
        "Content-Type": "application/json"
    },
    json={
        "actual_latency_ms": 1234,
        "actual_cost_usd": 0.0023,
        "actual_tokens_used": 456,
        "completion_success": True,
        "user_rating": 5
    }
)

print(f"Feedback recorded at: {response.json()['feedback_received_at']}")
```

### Node.js

```javascript
const decisionId = '550e8400-e29b-41d4-a716-446655440000';

// After making your LLM request, submit feedback
const response = await fetch(
  `https://api.pathfinder.naivana.io/v1/routes/${decisionId}/feedback`,
  {
    method: 'POST',
    headers: {
      'Authorization': 'Bearer sk_live_abc123...',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      actual_latency_ms: 1234,
      actual_cost_usd: 0.0023,
      actual_tokens_used: 456,
      completion_success: true,
      user_rating: 5
    })
  }
);

const result = await response.json();
console.log(`Feedback recorded at: ${result.feedback_received_at}`);
```

## Best Practices

### When to Submit Feedback

Submit feedback after every LLM request to maximize routing accuracy:

```python
# 1. Get routing decision
decision = pathfinder.decide(prompt="Your prompt here")

# 2. Make the actual LLM request
start_time = time.time()
try:
    llm_response = call_llm(
        model=decision['selected_model'],
        provider=decision['provider'],
        prompt=prompt
    )

    # 3. Submit success feedback
    pathfinder.submit_feedback(
        decision_id=decision['decision_id'],
        actual_latency_ms=int((time.time() - start_time) * 1000),
        actual_cost_usd=calculate_cost(llm_response),
        actual_tokens_used=llm_response.usage.total_tokens,
        completion_success=True
    )
except Exception as e:
    # 3. Submit failure feedback
    pathfinder.submit_feedback(
        decision_id=decision['decision_id'],
        actual_latency_ms=int((time.time() - start_time) * 1000),
        actual_cost_usd=0,
        actual_tokens_used=0,
        completion_success=False,
        error_type="error",
        error_message=str(e)
    )
```

### Handling Rate Limits

If you're submitting feedback at high volume, implement retry logic:

```python
import time
from requests.exceptions import HTTPError

def submit_feedback_with_retry(decision_id, feedback, max_retries=3):
    for attempt in range(max_retries):
        try:
            response = requests.post(
                f"https://api.pathfinder.naivana.io/v1/routes/{decision_id}/feedback",
                headers={"Authorization": f"Bearer {API_KEY}"},
                json=feedback
            )
            response.raise_for_status()
            return response.json()
        except HTTPError as e:
            if e.response.status_code == 429:
                # Rate limited - wait and retry
                time.sleep(0.1 * (attempt + 1))
            else:
                raise
    raise Exception("Max retries exceeded")
```

## Next Steps

- [Create Routing Decision](/docs/api/endpoints/routing-decision)
- [Get Decision by ID](/docs/api/endpoints/get-decision)
- [Error Handling](/docs/api/guides/error-handling)
