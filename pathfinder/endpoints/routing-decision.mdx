---
title: "POST /routes:decide"
description: "Get an intelligent routing decision for your prompt"
---

## Endpoint

```
POST https://api.pathfinder.naivana.io/v1/routes:decide
```

## Description

Analyzes your prompt and returns a routing decision with the recommended model, provider, and estimated cost.

**Privacy Note**: Your raw prompt is never stored. Only a SHA-256 hash and extracted features are saved.

## Request

### Headers

```http
Content-Type: application/json
Authorization: Bearer sk_live_your_api_key_here
```

### Request Body

```json
{
  "prompt": "Write a Python function that calculates fibonacci numbers",
  "constraints": ["provider:openai", "capability:code_generation"],
  "max_cost_usd": 0.05,
  "policy_name": "cost_optimized"
}
```

### Parameters

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `prompt` | string | Yes | The prompt to route (max 100,000 chars) |
| `constraints` | array | No | List of routing constraints (e.g., `["provider:openai"]`, `["only-gpt4"]`) |
| `max_cost_usd` | float | No | Maximum acceptable cost in USD |
| `policy_name` | string | No | Specific routing policy (e.g., `"cost_optimized"`, `"quality_first"`) |

## Response

### Success Response (200 OK)

```json
{
  "decision_id": "550e8400-e29b-41d4-a716-446655440000",
  "selected_model": "gpt-5.1",
  "provider": "openai",
  "confidence": 0.95,
  "estimated_cost_usd": 0.015,
  "fallback_models": ["claude-sonnet-4-5-20250929", "gemini-3-pro"],
  "reasoning": "GPT-5.1 selected for code generation task with high quality requirements",
  "timestamp": "2025-11-25T15:30:00Z",
  "routing_method": "heuristic",
  "routing_latency_ms": 1.8,
  "heuristic_rule_name": "python_code_requests",
  "heuristic_pattern_type": "keyword"
}
```

### Response Fields

| Field | Type | Description |
|-------|------|-------------|
| `decision_id` | string | Unique ID for this routing decision |
| `selected_model` | string | Recommended model ID |
| `provider` | string | Provider name (openai, anthropic, google, etc.) |
| `confidence` | float | Confidence score (0.0-1.0) |
| `estimated_cost_usd` | float | Estimated cost in USD |
| `fallback_models` | array | Alternative model IDs in priority order |
| `reasoning` | string | Human-readable explanation |
| `timestamp` | string | ISO 8601 timestamp |
| `routing_method` | string | Method used: `heuristic`, `ml`, or `policy` |
| `routing_latency_ms` | float | Time taken to make routing decision (ms) |
| `heuristic_rule_name` | string | Name of heuristic rule that matched (if applicable) |
| `heuristic_pattern_type` | string | Pattern type that matched (if applicable) |

## Error Responses

### 400 Bad Request

```json
{
  "error": {
    "code": "invalid_request",
    "message": "Prompt is required",
    "details": {
      "field": "prompt",
      "reason": "missing_required_field"
    }
  }
}
```

### 401 Unauthorized

```json
{
  "error": {
    "code": "unauthorized",
    "message": "Invalid API key"
  }
}
```

### 429 Too Many Requests

```json
{
  "error": {
    "code": "rate_limit_exceeded",
    "message": "Rate limit exceeded. Retry after 60 seconds",
    "retry_after": 60
  }
}
```

## Examples

### cURL

```bash
curl -X POST https://api.pathfinder.naivana.io/v1/routes:decide \
  -H "Authorization: Bearer sk_live_abc123..." \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "Write a Python function that calculates fibonacci numbers",
    "max_cost_usd": 0.05
  }'
```

### Python

```python
import requests

response = requests.post(
    "https://api.pathfinder.naivana.io/v1/routes:decide",
    headers={
        "Authorization": "Bearer sk_live_abc123...",
        "Content-Type": "application/json"
    },
    json={
        "prompt": "Write a Python function that calculates fibonacci numbers",
        "max_cost_usd": 0.05
    }
)

decision = response.json()
print(f"Use model: {decision['selected_model']} from {decision['provider']}")
```

### Node.js

```javascript
const response = await fetch('https://api.pathfinder.naivana.io/v1/routes:decide', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer sk_live_abc123...',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    prompt: 'Write a Python function that calculates fibonacci numbers',
    max_cost_usd: 0.05
  })
});

const decision = await response.json();
console.log(`Use model: ${decision.selected_model} from ${decision.provider}`);
```

## Next Steps

- [Get Decision by ID](/docs/api/endpoints/get-decision)
- [Python Integration Guide](/docs/api/guides/python-integration)
- [Error Handling](/docs/api/guides/error-handling)
